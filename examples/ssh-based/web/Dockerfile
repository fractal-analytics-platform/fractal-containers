FROM node:20-alpine3.21

RUN apk update
RUN apk add git

ARG FRACTAL_WEB_GIT

ENV NODE_MAJOR_VERSION=20

ENV FRACTAL_SERVER_HOST=http://server:8000
ENV PUBLIC_FRACTAL_VIZARR_VIEWER_URL=
ENV PUBLIC_FRACTAL_ADMIN_SUPPORT_EMAIL=
ENV PUBLIC_OAUTH_CLIENT_NAME=
ENV AUTH_COOKIE_DOMAIN=
ENV AUTH_COOKIE_SECURE=false
ENV LOG_FILE=fractal-web.log
ENV ORIGIN=http://localhost:5173
ENV PORT=5173
ENV LOG_LEVEL_CONSOLE=trace
ENV FRACTAL_RUNNER_BACKEND=slurm_ssh

COPY get_fractal_web.sh ./
RUN chmod +x get_fractal_web.sh
RUN sh get_fractal_web.sh
WORKDIR fractal-web

CMD ["node", "build"]
